source s_tcp_tls {
	tcp(ip(0.0.0.0) port(514) max-connections(256)
		tls(key_file("/etc/ssl/syslog-ng/machine.key")
			cert_file("/etc/ssl/syslog-ng/machine.crt")
			ca_dir("/etc/ssl/syslog-ng/ca.d")));
};

destination d_archive_messages { file("<%= node[:syslog][:archivedir] %>/$YEAR/$MONTH/$DAY/$HOST/messages"); };
destination d_archive_auth     { file("<%= node[:syslog][:archivedir] %>/$YEAR/$MONTH/$DAY/$HOST/auth.log"); };
destination d_archive_cron     { file("<%= node[:syslog][:archivedir] %>/$YEAR/$MONTH/$DAY/$HOST/cron.log"); };
destination d_archive_ftp      { file("<%= node[:syslog][:archivedir] %>/$YEAR/$MONTH/$DAY/$HOST/ftp.log"); };
destination d_archive_kern     { file("<%= node[:syslog][:archivedir] %>/$YEAR/$MONTH/$DAY/$HOST/kern.log"); };
destination d_archive_mail     { file("<%= node[:syslog][:archivedir] %>/$YEAR/$MONTH/$DAY/$HOST/mail.log"); };
destination d_archive_debug    { file("<%= node[:syslog][:archivedir] %>/$YEAR/$MONTH/$DAY/$HOST/debug.log"); };
destination d_archive_error    { file("<%= node[:syslog][:archivedir] %>/$YEAR/$MONTH/$DAY/$HOST/error.log"); };

log { source(s_tcp_tls); filter(f_messages); destination(d_archive_messages); };
log { source(s_tcp_tls); filter(f_auth);     destination(d_archive_auth); };
log { source(s_tcp_tls); filter(f_cron);     destination(d_archive_cron); };
log { source(s_tcp_tls); filter(f_ftp);      destination(d_archive_ftp); };
log { source(s_tcp_tls); filter(f_kern);     destination(d_archive_kern); };
log { source(s_tcp_tls); filter(f_mail);     destination(d_archive_mail); };
log { source(s_tcp_tls); filter(f_debug);    destination(d_archive_debug); };
log { source(s_tcp_tls); filter(f_error);    destination(d_archive_error); };
