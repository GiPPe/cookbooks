# Generated by Chef.
# Local modifications will be overwritten.

<% case node[:rsyslog][:protocol] -%>
<% when "tcp" -%>
$ModLoad imtcp
$InputTCPServerRun 514
<% when "udp" -%>
$ModLoad imudp
$UDPServerRun 514
<% end -%>

$template PerHostMessages,"<%= node[:rsyslog][:logdir] %>/%$YEAR%/%$MONTH%/%$DAY%/%HOSTNAME%/messages"
$template PerHostAuth,"<%= node[:rsyslog][:logdir] %>/%$YEAR%/%$MONTH%/%$DAY%/%HOSTNAME%/auth.log"
$template PerHostCron,"<%= node[:rsyslog][:logdir] %>/%$YEAR%/%$MONTH%/%$DAY%/%HOSTNAME%/cron.log"
$template PerHostMail,"<%= node[:rsyslog][:logdir] %>/%$YEAR%/%$MONTH%/%$DAY%/%HOSTNAME%/mail.log"
$template PerHostMailInfo,"<%= node[:rsyslog][:logdir] %>/%$YEAR%/%$MONTH%/%$DAY%/%HOSTNAME%/mail.info"
$template PerHostMailWarn,"<%= node[:rsyslog][:logdir] %>/%$YEAR%/%$MONTH%/%$DAY%/%HOSTNAME%/mail.warn"
$template PerHostMailErr,"<%= node[:rsyslog][:logdir] %>/%$YEAR%/%$MONTH%/%$DAY%/%HOSTNAME%/mail.err"
$template PerHostError,"<%= node[:rsyslog][:logdir] %>/%$YEAR%/%$MONTH%/%$DAY%/%HOSTNAME%/error.log"
$template PerHostDebug,"<%= node[:rsyslog][:logdir] %>/%$YEAR%/%$MONTH%/%$DAY%/%HOSTNAME%/debug.log"
$template PerHostKern,"<%= node[:rsyslog][:logdir] %>/%$YEAR%/%$MONTH%/%$DAY%/%HOSTNAME%/kern.log"

*.*;auth,authpriv,cron,kern,mail.none \
  -?PerHostMessages

auth,authpriv.* \
  ?PerHostAuth

cron.* \
  -?PerHostCron

mail.* \
  -?PerHostMail

mail.info \
  -?PerHostMailInfo

mail.warn \
  -?PerHostMailWarn

mail.err \
  ?PerHostMailErr

*.error \
  ?PerHostError

*.=debug \
  -?PerHostDebug
<% if node[:virtualization][:role] == "host" %>

kern.* \
  ?PerHostKern
<% end %>
